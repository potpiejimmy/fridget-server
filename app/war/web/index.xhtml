<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Fridget - Spark Core Configuration</title>
    </h:head>
    <h:body>
        <f:view>
            <h:form id="configForm">
                <p:panel id="outputPanel" header="Spark Core Configuration">

                    <h:panelGrid columns="3">
                        <h:outputLabel for="selectDevice" value="Select Device:"/>
                        <p:selectOneMenu id="selectDevice" value="#{deviceDebugBean.selectedDevice}">
                            <p:ajax event="change" update="outputPanel"/>
                            <f:selectItems value="#{deviceDebugBean.devicesSelectItems}"/>
                        </p:selectOneMenu>
                        <p:message for="selectDevice"/>
                        
                        <h:outputLabel for="connectToCloud" value="Connect to cloud only:"/>
                        <p:selectBooleanCheckbox id="connectToCloud" value="#{deviceDebugBean.connectToCloud}" disabled="#{deviceDebugBean.selectedDevice eq null}"/>
                        <p:message for="connectToCloud"/>
                        
                        <h:outputLabel for="wakeTime" value="Configure wake time (sec.) (blue LED on):"/>
                        <p:inputText id="wakeTime" value="#{deviceDebugBean.wakeTime}" disabled="#{deviceDebugBean.selectedDevice eq null}"/>
                        <p:message for="wakeTime"/>
                        
                        <h:outputLabel for="sleepTime" value="Configure sleep time (sec.) (deep-sleep):"/>
                        <p:inputText id="sleepTime" value="#{deviceDebugBean.sleepTime}" disabled="#{deviceDebugBean.selectedDevice eq null}"/>
                        <p:message for="sleepTime"/>
                        
                        <h:outputLabel for="connectCycle" value="Connect cycle (# of wakes until WiFi connect):"/>
                        <p:inputText id="connectCycle" value="#{deviceDebugBean.connectCycle}" disabled="#{deviceDebugBean.selectedDevice eq null}"/>
                        <p:message for="connectCycle"/>
                        
                        <h:outputLabel for="flashImage" value="Fetch and flash image on WiFi connect:"/>
                        <p:selectBooleanCheckbox id="flashImage" value="#{deviceDebugBean.flashImage}" disabled="#{deviceDebugBean.selectedDevice eq null}"/>
                        <p:message for="flashImage"/>
                        
                    </h:panelGrid>
                    
                    <p:commandButton action="#{deviceDebugBean.save}" update="outputPanel" value="Save" disabled="#{deviceDebugBean.selectedDevice eq null}"/>

                    <h:panelGrid columns="3">
                        <h:outputLabel for="imgUpload" value="Image Upload:"/>
                        <p:fileUpload id="imgUpload" fileUploadListener="#{deviceDebugBean.handleFileUpload}" mode="advanced" disabled="#{deviceDebugBean.selectedDevice eq null}"
                                     update="messages,origImgDisplay,imgDisplay,epdDownload" auto="true" sizeLimit="5000000" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"/>
                        <p:message for="imgUpload"/>
                        
                        <h:outputLabel for="origImgDisplay" value="Your image:"/>
                        <p:outputPanel id="origImgDisplay">
                            <p:graphicImage value="#{deviceDebugBean.originalImage}" cache="false" rendered="#{deviceDebugBean.originalImage ne null}"/>
                        </p:outputPanel>
                        <h:panelGroup/>
                        
                        <h:outputLabel for="imgDisplay" value="Spectra 400x300:"/>
                        <p:outputPanel id="imgDisplay">
                            <p:graphicImage value="#{deviceDebugBean.image}" cache="false" rendered="#{deviceDebugBean.image ne null}"/>
                        </p:outputPanel>
                        <h:panelGroup/>
                        
                        <h:outputLabel for="epdDownload" value="EPD File:"/>
                        <p:outputPanel id="epdDownload">
                            <h:outputLink value="#{request.contextPath}/res/img/#{deviceDebugBean.selectedDeviceSerial}" rendered="#{deviceDebugBean.image ne null}">
                                <h:outputText value="Download"/>
                            </h:outputLink>
                        </p:outputPanel>
                        <h:panelGroup/>

                    </h:panelGrid> 

                    <p:growl id="messages" showDetail="true"/>  
                        
                    <p:outputPanel id="logPanel" rendered="#{deviceDebugBean.selectedDevice ne null}">
                        <p:scrollPanel mode="native" style="height:400px">
                            <h:dataTable id="log" styleClass="no-table-header" value="#{deviceDebugBean.debugMessages}" var="msg">
                                <h:column>
                                    <h:outputText value="[#{msg.adDeviceId}] #{deviceDebugBean.getFormattedDate(msg.date)} #{msg.message}"/>
                                </h:column>
                            </h:dataTable>
                            <p:poll id="logPoll" interval="2" update="log" rendered="#{deviceDebugBean.autoUpdate}"/>
                        </p:scrollPanel>

                        <h:panelGrid id="logsettings" columns="4" style="margin-bottom:10px" cellpadding="5">
                            <p:commandButton action="#{deviceDebugBean.clearLog}" update="outputPanel" value="Clear log" disabled="#{deviceDebugBean.selectedDevice eq null}"/>
                            <p:selectBooleanCheckbox id="autoUpdate" value="#{deviceDebugBean.autoUpdate}" onchange="this.form.submit();"/>
                            <h:outputLabel for="autoUpdate" value="Auto update log" />
                            <p:ajaxStatus style="width:16px;height:16px;" id="ajaxStatusPanel">  
                                <f:facet name="start">  
                                    <h:graphicImage value="/webres/img/ajax-loader.gif" />  
                                </f:facet>  
                                <f:facet name="complete">  
                                    <h:outputText value="" />  
                                </f:facet>  
                            </p:ajaxStatus>  
                        </h:panelGrid>
                    </p:outputPanel>
                </p:panel>
            </h:form>
        </f:view>
    </h:body>
</html>

